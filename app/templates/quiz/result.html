{% extends "base.html" %}
{% block title %}K·∫øt qu·∫£ | {{ submission.quiz.title }}{% endblock %}

{% block content %}
<div class="card-soft p-4 mb-4">
    <div class="row align-items-center">
        <div class="col-md-4 text-center mb-3 mb-md-0">
            <div class="score-circle" style="--score: {{ submission.score * 10 // 1 }}">
                <div class="score-inner">
                    {{ "%.1f"|format(submission.score) }}
                </div>
            </div>
            <p class="page-subtitle mb-1">
                ƒêi·ªÉm s·ªë (thang 10)
            </p>
            <small class="text-muted">
                ƒê√∫ng {{ submission.correct_answers }}/{{ submission.total_questions }}
            </small>
        </div>
        <div class="col-md-8">
            <h2 class="page-title mb-2">{{ submission.quiz.title }}</h2>
            <p class="page-subtitle">
                N·ªôp l√∫c: {{ submission.finished_at or submission.created_at }}
                <br />
                Th·ªùi gian l√†m: {{ submission.time_spent or 0 }} gi√¢y
            </p>

            <div class="d-flex flex-wrap gap-2 mt-2">
                <a href="{{ url_for('quiz.quiz_list') }}" class="btn btn-outline-soft btn-sm">
                    ‚Üê V·ªÅ danh s√°ch quiz
                </a>

                {% if quiz.show_explanation %}
                <a href="{{ url_for('quiz.review_submission', submission_id=submission.id) }}"
                   class="btn btn-primary-soft btn-sm">
                    üîç Xem l·∫°i ƒë√°p √°n & gi·∫£i th√≠ch
                </a>
                {% endif %}

                <a href="{{ url_for('quiz.leaderboard', quiz_id=quiz.id) }}"
                   class="btn btn-outline-soft btn-sm">
                    üèÜ Leaderboard
                </a>

                {% if certificate %}
                <a href="{{ url_for('quiz.download_certificate', quiz_id=quiz.id) }}"
                   class="btn btn-primary-soft btn-sm">
                    üéì T·∫£i ch·ª©ng ch·ªâ
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card-soft p-3 mb-3">
    <h5 class="mb-3">Th·ªëng k√™ b√†i l√†m n√†y</h5>
    <div class="row">
        <div class="col-md-4">
            <ul class="list-unstyled page-subtitle">
                <li>‚Ä¢ T·ªïng s·ªë c√¢u: {{ submission.total_questions }}</li>
                <li>‚Ä¢ S·ªë c√¢u ƒë√∫ng: {{ submission.correct_answers }}</li>
                <li>‚Ä¢ S·ªë c√¢u sai: {{ submission.total_questions - submission.correct_answers }}</li>
                <li>‚Ä¢ ƒêi·ªÉm ƒë·∫°t: {{ "%.1f"|format(submission.score) }}/10</li>
                <li>‚Ä¢ Tr·∫°ng th√°i:
                    {% if submission.score >= quiz.pass_score %}
                        <span class="text-success">ƒê·∫°t</span>
                    {% else %}
                        <span class="text-danger">Ch∆∞a ƒë·∫°t</span>
                    {% endif %}
                </li>
            </ul>
        </div>
        <div class="col-md-8">
            <canvas id="scoreChart" height="150"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const ctx = document.getElementById("scoreChart");
    {% if score_labels and score_values %}
    const labels = {{ score_labels|tojson }};
    const data = {{ score_values|tojson }};
    {% else %}
    const labels = ["L·∫ßn n√†y"];
    const data = [{{ submission.score }}];
    {% endif %}

    if (ctx) {
        new Chart(ctx, {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: "ƒêi·ªÉm theo t·ª´ng l·∫ßn l√†m",
                    data: data,
                    tension: 0.3,
                    fill: false,
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10
                    }
                }
            }
        });
    }
</script>
{% endblock %}
